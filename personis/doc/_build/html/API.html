

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Application Program Interface &mdash; Personis 12.9 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '12.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Personis 12.9 documentation" href="index.html" />
    <link rel="next" title="Model Definition Format" href="Modeldef.html" />
    <link rel="prev" title="Example Applications" href="Examples.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Modeldef.html" title="Model Definition Format"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Examples.html" title="Example Applications"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Personis 12.9 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="application-program-interface">
<h1>Application Program Interface<a class="headerlink" href="#application-program-interface" title="Permalink to this headline">¶</a></h1>
<p>See <a class="reference internal" href="personis.html"><em>personis Package</em></a> for API documentation.</p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Models can be accessed either locally in the filesystem, or via a server.</p>
<p>Local access is via the <cite>base</cite> module.</p>
<p><strong>Basic accretion operation - tell some evidence</strong></p>
<p>The following example shows the use of <cite>base</cite> to <em>tell</em> a piece of evidence
containing a name string to a component in the model.  The source of the evidence is &#8220;contactapp&#8221; which will have
been given access to the model by the owner.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">base</span>

<span class="c"># access the model in the filesystem</span>
<span class="c"># model name is &quot;alice&quot;, model is stored in directory &quot;Models&quot;</span>
<span class="n">um</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Access</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;alice&quot;</span><span class="p">,</span> <span class="n">modeldir</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;contactapp&#39;</span><span class="p">)</span>

<span class="c"># create a piece of evidence with Alice as value</span>
<span class="n">ev</span> <span class="o">=</span> <span class="n">Personis_base</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span><span class="n">evidence_type</span><span class="o">=</span><span class="s">&quot;explicit&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;Alice&quot;</span><span class="p">)</span>

<span class="c"># tell this as user alice&#39;s first name into component &quot;firstname&quot;, context &quot;Personal&quot;</span>
<span class="n">um</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">componentid</span><span class="o">=</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span> <span class="n">evidence</span><span class="o">=</span><span class="n">ev</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Basic resolution operation - ask for a value</strong></p>
<p>This example <a href="#id1"><span class="problematic" id="id2">*</span></a>ask*s for the value of a component using the default resolver that uses the most recent piece of
evidence.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">base</span>

<span class="n">um</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Access</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;alice&quot;</span><span class="p">,</span> <span class="n">modeldir</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;contactapp&#39;</span><span class="p">)</span>

<span class="c"># now ask for the value of the component using the default resolver and the last piece of evidence</span>
<span class="n">reslist</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">view</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;firstname&quot;</span><span class="p">],</span> <span class="n">resolver</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">evidence_filter</span><span class="o">=</span><span class="s">&quot;last1&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>A <em>view</em> is just a list of components. The list can be explicit in the ask request or we can give a view a
name and store it in the model.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># now ask for the value of two components using a view</span>
<span class="n">reslist</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">view</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span> <span class="s">&quot;lastname&quot;</span><span class="p">],</span> <span class="n">resolver</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">evidence_filter</span><span class="o">=</span><span class="s">&quot;last1&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>We can make a view using a view object and the <em>mkview</em> method. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">base</span>

<span class="n">um</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Access</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;alice&quot;</span><span class="p">,</span> <span class="n">modeldir</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;contactapp&#39;</span><span class="p">)</span>

<span class="n">vobj</span> <span class="o">=</span> <span class="n">Personis_base</span><span class="o">.</span><span class="n">View</span><span class="p">(</span><span class="n">Identifier</span><span class="o">=</span><span class="s">&quot;fullname&quot;</span><span class="p">,</span> <span class="n">component_list</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span> <span class="s">&quot;lastname&quot;</span><span class="p">])</span>
<span class="n">um</span><span class="o">.</span><span class="n">mkview</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">viewobj</span><span class="o">=</span><span class="n">vobj</span><span class="p">)</span>

<span class="n">reslist</span><span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">view</span> <span class="o">=</span> <span class="s">&#39;fullname&#39;</span><span class="p">,</span> <span class="n">resolver</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;evidence_filter&#39;</span><span class="p">:</span><span class="s">&quot;all&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>The values are returned by an ask request in a list of component objects, one for eachc component value requested.
The component objects have the attributes described in the documentation above but this includes
a <em>value</em> attribute  which is the resolved value for the component. Eg:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reslist</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">view</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;firstname&quot;</span><span class="p">],</span> <span class="n">resolver</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">evidence_filter</span><span class="o">=</span><span class="s">&quot;last1&quot;</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&quot;Firstname:&quot;</span><span class="p">,</span> <span class="n">reslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p><strong>Creating new contexts and components</strong></p>
<p>The <em>mkcontext</em> and <em>mkcomponent</em> methods, along with the <em>Component</em> and <em>Context</em> objects, are used to build
new elements in the model. Here is an example of creating and then deleting a context:</p>
<div class="highlight-python"><pre># assume we have accessed the model
print "creating context 'Deltest' in context 'Personal'"
cobj = base.Context(Identifier="Deltest", Description="testing context deletion")
# now make the new context
um.mkcontext(context=["Personal"], contextobj=cobj)

print "now delete it"
um.delcontext(context=["Personal", "Deltest"]):</pre>
</div>
<p>and here is an example of creating and then deleting a component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cobj</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="n">Identifier</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">component_type</span><span class="o">=</span><span class="s">&quot;attribute&quot;</span><span class="p">,</span> <span class="n">Description</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">goals</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;Personal&#39;</span><span class="p">,</span> <span class="s">&#39;Health&#39;</span><span class="p">,</span> <span class="s">&#39;weight&#39;</span><span class="p">]],</span> <span class="n">value_type</span><span class="o">=</span><span class="s">&quot;number&quot;</span><span class="p">)</span>

<span class="n">um</span><span class="o">.</span><span class="n">mkcomponent</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">componentobj</span><span class="o">=</span><span class="n">cobj</span><span class="p">)</span>

<span class="c"># tell some evidence to the new component</span>
<span class="n">ev</span> <span class="o">=</span> <span class="n">Personis_base</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span><span class="n">evidence_type</span><span class="o">=</span><span class="s">&quot;explicit&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">um</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">componentid</span><span class="o">=</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="n">evidence</span><span class="o">=</span><span class="n">ev</span><span class="p">)</span>
<span class="n">reslist</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">view</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;age&#39;</span><span class="p">],</span> <span class="n">resolver</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;evidence_filter&#39;</span><span class="p">:</span><span class="s">&quot;all&quot;</span><span class="p">})</span>
<span class="k">print</span> <span class="s">&quot;Age:&quot;</span><span class="p">,</span> <span class="n">reslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<span class="c"># delete the component</span>
<span class="n">resd</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">delcomponent</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">componentid</span> <span class="o">=</span> <span class="s">&quot;age&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Navigating the Model</strong></p>
<p>If you want to discover what contexts are present in the model there is a variant on the <em>ask</em> method that
allows you to get a list of all the <em>contexts</em>, <em>components</em>, <em>views</em> and <em>subscriptions</em> that are
contained in a given context. Just add the parameter &#8220;showcontexts=True&#8221; to the <em>ask</em> call.
Using this call you can start at the root context and walk the tree of contexts discovering the full
contents of the model. Eg:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&quot;Show the root context&quot;</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">],</span> <span class="n">showcontexts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The return value is a tuple containing (componentlist, contextlist, viewlist, sublist), where each part
of the tuple is a list of objects.</p>
<p><strong>Subscriptions: rules for action</strong></p>
<p>A feature of Personis is the ability to add a rule to a component that is examined when ever a <em>tell</em> operation
is performed on the component. The rule typically examines a resolved value of the component, matching against a
pattern. If the pattern is matched an action is initiated. The action can be a <em>tell</em> operation to tell some
evidence to a component, or a <em>notify</em> operation that will construct a URL and fetch it, thus initiating some
action at an external web site.  Rules can be deleted using the <em>delete_sub</em> method.</p>
<p>Note that you need to use <cite>active</cite> instead of <cite>base</cite> as that is where the subscription methods are found.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">base</span>
<span class="kn">import</span> <span class="nn">active</span>

<span class="n">um</span> <span class="o">=</span> <span class="n">Personis_a</span><span class="o">.</span><span class="n">Access</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;alice&quot;</span><span class="p">,</span> <span class="n">modeldir</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;contactapp&#39;</span><span class="p">)</span>

<span class="c"># subscription rule that will match firstname against a wildcard pattern (regular expression):</span>
<span class="n">sub</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;default!./Personal/firstname&gt; ~ &#39;.*&#39; :</span>
<span class="s">         NOTIFY &#39;http://www.myweb.me/~alice/action.cgi?&#39; &#39;firstname=&#39; &lt;./Personal/firstname&gt;</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="c"># a token identifying the rule is returned</span>
<span class="n">subtoken</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">view</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;firstname&#39;</span><span class="p">],</span> <span class="n">subscription</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;user&#39;</span><span class="p">:</span><span class="s">&#39;alice&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">:</span><span class="s">&#39;secret&#39;</span><span class="p">,</span> <span class="s">&#39;statement&#39;</span><span class="p">:</span><span class="n">sub</span><span class="p">})</span>

<span class="n">ev</span> <span class="o">=</span> <span class="n">Personis_base</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span><span class="n">evidence_type</span><span class="o">=</span><span class="s">&quot;explicit&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;Alice&quot;</span><span class="p">)</span>
<span class="c"># do a tell. This should cause the action.cgi script to be invoked with the firstame</span>
<span class="n">um</span><span class="o">.</span><span class="n">tell</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">componentid</span><span class="o">=</span><span class="s">&#39;firstname&#39;</span><span class="p">,</span> <span class="n">evidence</span><span class="o">=</span><span class="n">ev</span><span class="p">)</span>

<span class="c"># delete the rule</span>
<span class="n">um</span><span class="o">.</span><span class="n">delete_sub</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">componentid</span><span class="o">=</span><span class="s">&#39;lastname&#39;</span><span class="p">,</span> <span class="n">subname</span><span class="o">=</span><span class="n">subtoken</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Import and Export of Models</strong></p>
<p>Models can be imported and exported in JSON (JavaScript Object Notation)
form using the <em>export_model</em> and <em>import_model</em> methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">base</span>
<span class="kn">import</span> <span class="nn">active</span>

<span class="n">um</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">Access</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">&quot;alice&quot;</span><span class="p">,</span> <span class="n">modeldir</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;contactapp&#39;</span><span class="p">)</span>

<span class="c"># export a model sub tree to JSON</span>
<span class="c"># note that all evidence will also be exported.</span>
<span class="n">modeljson</span> <span class="o">=</span> <span class="n">um</span><span class="o">.</span><span class="n">export_model</span><span class="p">([</span><span class="s">&quot;Personal&quot;</span><span class="p">],</span> <span class="n">evidence_filter</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">modeljson</span>

<span class="c"># import the same model tree but into a different context.</span>
<span class="n">um</span><span class="o">.</span><span class="n">import_model</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Temp&quot;</span><span class="p">],</span> <span class="n">partial_model</span><span class="o">=</span><span class="n">modeljson</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Application Program Interface</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Examples.html"
                        title="previous chapter">Example Applications</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Modeldef.html"
                        title="next chapter">Model Definition Format</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/API.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Modeldef.html" title="Model Definition Format"
             >next</a> |</li>
        <li class="right" >
          <a href="Examples.html" title="Example Applications"
             >previous</a> |</li>
        <li><a href="index.html">Personis 12.9 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012, Bob Kummerfeld and Judy Kay.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>